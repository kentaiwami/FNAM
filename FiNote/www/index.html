<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, minimum-scale=1, width=device-width" />

        <link rel="stylesheet" href="onsen/css/onsenui.css">
        <link rel="stylesheet" href="onsen/css/onsen-css-components.css">
        <link rel="stylesheet" href="css/index.css">

        <script src="js/index.js"></script>
        <script src="onsen/js/onsenui.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/ncmb.min.js" charset="utf-8"></script>
    </head>

    <body>
    <ons-navigator id="navigator">
        <ons-page id="splash">
            <script>
                //ユーザ情報が存在する場合はローディング画面を表示する
                var storage = window.localStorage;
                var signup_flag = storage.getItem('signup_flag');
                if (signup_flag == 'true') {
                    document.write('<img  src="img/splash.gif" alt="" / width="100%" height="100%">');
                }
            </script>
        </ons-page>
    </ons-navigator>

        <!--2秒間たったら画面遷移する!-->
    <script>
       //delete_localstorage();

        var storage = window.localStorage;

        // storage.setItem('username', 'test')
        // storage.setItem('password', 'test')
        // storage.setItem('signup_flag', true)

        var signup_flag = storage.getItem('signup_flag');

        //ユーザ情報が登録されている場合は自動ログインを行う
        if (signup_flag == 'true') {
            //自動ログイン
            var ncmb = get_ncmb();
            var storage = window.localStorage;
            var username = storage.getItem('username');
            var password = storage.getItem('password');

            ncmb.User.login(username, password)
                .then(function(data){
                    // ログイン後処理
                    //tabbar.htmlへ遷移
                    var showpage = function(){
                        document.querySelector('#navigator').pushPage('tabbar.html', { animation : 'fade' } )
                    };
                    setTimeout(showpage, 2000);

                })
            .catch(function(err){
                // エラー処理
                });

        //ユーザ情報が登録されていない場合はsignupへ遷移
        }else {
            //signup.htmlへ遷移
            var showpage = function(){
                document.querySelector('#navigator').pushPage('signup.html', { animation : 'fade' } )
            };
            setTimeout(showpage, 0);
        }
    </script>
    </body>
</html>
